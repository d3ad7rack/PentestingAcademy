#!/bin/bash
# Script-Stage1 - Ping live hosts to get ip-list
# Generate IP-List for use in discovery

for ip in $(seq 1 254); do
ping -c1 192.168.0.$ip | grep "bytes from " | cut -d " " -f4 | cut -d ":" -f1 >> ips.list;
done

# Enter Script-Stage2
# NBTScan to find information from SMB Null connects

sudo nbtscan -f ips.list >> nbtscan.txt

# Enter Script-Stage3
# Scan for web servers, and get version of web server with nmap and httprint

cp /usr/share/nmap/nmap.xsl .
nmap -p80 -iL ips.list -sV -oN 80scan.nmap --stylesheet nmap.xsl
httprint -i ips.list -s /usr/bin/httprint_301/linux/signatures.txt -P0 > httprint.txt

# Enter Script-Stage4
# Enumerate SNMP Information with snmpcheck - download perl script from www.nothink.org/codes/snmpcheck/snmpcheck-1.8.pl

filename="$1"
while read line
do
        ip=$line
        sudo perl snmpcheck.pl -t $ip >> snmpcheck.txt
done < $1

# Enter Script-Stage5
# Look for vulnerabilities using nmap

nmap -iL ips.list --script=vuln --script-args=unsafe=0 --stylesheet nmap.xsl -oN vulnscan.nmap

# Enter Script-Stage6
# Version detection of services running on boxes

nmap -sV -iL ips.list --stylesheet nmap.xsl -oN VerDetect.nmap

# Enter Script-Stage7
# OS Detection of computers that are alive and responding to ICMP pings

nmap -O -iL ips.list --stylesheet nmap.xsl -oN OSDetect.nmap

# Enter Script-Stage8
# Look for gateways, so that we can have direct access to the internet

sudo arp-scan -l | tee arp.txt && sudo python gateway-finder.py -f arp.txt -i 209.85.227.99 >> gateway-find.txt

# Generate report.txt and cleanup
echo "List of machines that are up and responding to pings" > report.txt
echo " " >> report.txt
cat ips.list >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "NBTScan Report" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat nbtscan.txt >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "NMap port 80 Scan for webservers" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat 80scan.nmap >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "HttPrint report" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat httprint.txt >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "SNMPcheck report" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat snmpcheck.txt >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "Nmap Vulnerability Scan" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat vulnscan.nmap >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "Nmap Version detection" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat VerDetect.nmap >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "Nmap OS Detection" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat OSDetect.nmap >> report.txt 2>&1
echo " " >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "Gateway-finder report" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo " " >> report.txt
cat gateway-find.txt >> report.txt 2>&1
echo "----------------------------------------------------------------------------------------------" >> report.txt
echo "----------------------------------------------------------------------------------------------" >> report.txt
#
#
#
#
#
rm ips.list
rm nbtscan.txt
rm 80scan.nmap
rm httprint.txt
rm snmpcheck.txt
rm vulnscan.nmap
rm VerDetect.nmap
rm OSDetect.nmap
rm gateway-find.txt
rm arp.txt
